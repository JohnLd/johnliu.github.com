---
layout : post 
category : Android
tags : [Android]
desc : 监听软键盘状态的改变

title : 监听软键盘状态的改变
---

很多时候，我们希望能监听软键盘的状态的改变，但不尽人意的是，android没有提供相应的监听。
在网上找了很多种方法，都不是很理想，很方便，最后在stackoverflow上找到了我想要的Awesome code！
 
 
//先定义一个interface 

    public interface OnKeyboardStatusChangedListener {

        public void onChanged(boolean isOpen);

    }
 

//最重要的代码 

    public void setKeyboardStatusChanged(final OnKeyboardStatusChangedListener listener) {
        final View root = ((ViewGroup) this.findViewById(android.R.id.content)).getChildAt(0);
        root.getViewTreeObserver().addOnGlobalLayoutListener(new OnGlobalLayoutListener() {

            private boolean hasOpened;
            private final Rect rect = new Rect();

            @Override
            public void onGlobalLayout() {
                root.getWindowVisibleDisplayFrame(rect);
                int heightDiff = root.getRootView().getHeight() - (rect.bottom - rect.top);
                boolean isOpen = heightDiff > 100;
                if (isOpen == hasOpened) {
                    return;
                }
                hasOpened = isOpen;
                if (listener != null) listener.onChanged(isOpen);
            }
        });
    }
 